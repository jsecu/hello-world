<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Pentesting Workshop: Working with OWASP JuiceShop | JSECU</title><meta name="description" content="JSECU"><meta itemprop="name" content="JSECU"><meta itemprop="description" content="JSECU"><meta itemprop="image" content="http://localhost:4000/images/pentester.png"><meta property="og:url" content="http://localhost:4000/2020/07/03/juiceshop/"><meta property="og:type" content="website"><meta property="og:title" content="Pentesting Workshop: Working with OWASP JuiceShop | JSECU"><meta property="og:site_name" content="JSECU"><meta property="og:description" content="JSECU"><meta property="og:image" content="http://localhost:4000/images/pentester.png"><meta name="twitter:url" content="/2020/07/03/juiceshop/"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Pentesting Workshop: Working with OWASP JuiceShop | JSECU"><meta name="twitter:site" content="JSECU"><meta name="twitter:description" content="JSECU"><meta name="twitter:creator" content="@Pullerze"><meta property="twitter:image" content="http://localhost:4000/images/pentester.png"><link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico"><link rel="stylesheet" href="/assets/css/app.min.css"><link rel="alternate" type="application/rss+xml" title="JSECU" href="/feed.xml"><link rel="canonical" href="/2020/07/03/juiceshop/"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'n', 'auto'); ga('send', 'pageview'); </script></head><body id="pentesting-workshop-working-with-owasp-juiceshop" class="post-layout"><header class="header"> <a class="header__title" href="/">JSECU</a><nav><ul class="header__list"><li><a href="/">Posts</a></li><li><a href="/about">About</a></li></ul></nav></header><main class="üíà"><div class="post"><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><div class="post__header section-padding--double"><div class="grid-small"><h2 itemprop="name headline">Pentesting Workshop: Working with OWASP JuiceShop</h2><time class="post__date" datetime="2020-07-03T14:05:00-04:00" itemprop="datePublished">3 Jul 2020</time></div></div><div class="post__content section-padding"><div class="grid"><div id="markdown" itemprop="articleBody"><p>This is a simple introduction of OWASP Juiceshop that I presented at day 2 of my pentesting workshop. It covers 5 of the OWASP top 10 and gives examples of where you can find them in the JuiceShop platform. This is meant to be a practical follow along guide with the JuiceShop platform so if you use this guide to learn web application pentesting, it would be advised to download JuiceShop beforehand.</p><center><img src="../../../../images/pentester.png" /></center><p>In this Workshop we‚Äôre going to be looking more depth at web applications. Last workshop we covered more of the bigger picture when we looked at ports and IP addresses. Web Applications usually reside on port 80 on application servers. Popular application servers include Apache, IIS and Nginx. In a lot of cases web application vulnerabilities can be a great way for hackers to infiltrate into a server and gain a foothold on an network. In order to learn about web application pentesting we‚Äôre going to use an intentionally vulnerable web application created by OWASP called JuiceShop. Juice Shop is based off a modern web application that includes many of the same functions you would see in a real production website. OWASP is a group that promotes good security practices and even makes a top 10 most abused web applications list every year:</p><center><img src="../../../../images/owasp.jpeg.webp" /></center><p>In today‚Äôs workshop we‚Äôre only going to cover 4 out of the 10 categories listed in their Top 10. These categories include</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Injection
Broken Authentication
Cross Site Scripting
Broken Access Control
</code></pre></div></div><p>In order to launch the Juice Shop program, just go to the url I provide during the Workshop. If you want to access it at home it‚Äôs easy to setup using heroku.com, you can access instructions for this at this url: <a href="https://github.com/bkimminich/juice-shop">https://github.com/bkimminich/juice-shop</a></p><p>Tools Needed:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FireFox 
</code></pre></div></div><p>Firefox has good tools for intercepting background web traffic including http requests, responses and api calls.</p><h1>i.Injection</h1><p>‚ÄúInjection flaws allow attackers to relay malicious code through an application to another system. These attacks include calls to the operating system via system calls, the use of external programs via shell commands, as well as calls to backend databases via SQL (i.e., SQL injection). Whole scripts written in Perl, Python, and other languages can be injected into poorly designed applications and executed. Any time an application uses an interpreter of any type there is a danger of introducing an injection vulnerability.</p><p>SQL injection is a particularly widespread and dangerous form of injection. To exploit a SQL injection flaw, the attacker must find a parameter that the web application passes through to a database. By carefully embedding malicious SQL commands into the content of the parameter, the attacker can trick the web application into forwarding a malicious query to the database. These attacks are not difficult to attempt and more tools are emerging that scan for these flaws. The consequences are particularly damaging, as an attacker can obtain, corrupt, or destroy database contents.</p><p>Injection vulnerabilities can be very easy to discover and exploit, but they can also be extremely obscure. The consequences of a successful injection attack can also run the entire range of severity, from trivial to complete system compromise or destruction. In any case, the use of external calls is quite widespread, so the likelihood of an application having an injection flaw should be considered high‚Äù -OWASP <a href="https://github.com/bkimminich/juice-shop">https://github.com/bkimminich/juice-shop</a></p><p>To illustrate this vulnerability we‚Äôre going to exploit a sql injection in the login portal of the Juice Shop application. This technique is used to bypass login screens and get access to privileged users. So imagine the SQL query to the database from a login page is ‚Äú SELECT username, password from Users where username = ‚Äú[username here]‚Äù and password = ‚Äú[password here]‚Äù ‚Äú. We have access to this query when we input data in a login form, which means we can control it using our own SQL queries. What we can do here is enter ‚Äò or 1=1 ‚Äî in the username field and anything for the password field. So the query would now look like ‚ÄúSELECT username, password from Users where username=‚Äô‚Äôor 1=1 ‚Äî and password = aaa‚Äù. What the ‚Äòor 1=1 ‚Äî does is closes the previous quote with a quote and makes a second condition with the or command. The 1=1 is stating to return if true, since 1=1 is always true, we‚Äôll be supplied with the first user in the database. The ‚Äî at the end comments out the rest of SQL query. After that executes we‚Äôre now logged in as a admin user.</p><h3>Mitigation:</h3><p>Usually this happens because the SQL interpreter can‚Äôt differentiate between the query and application data. There are several ways to block this type of attack from happening, but the most successful way is using prepared statements. This allows for a static sql query instead of an dynamic one that was used before and you can pass external input into this static query through parameters.The query is already precompiled so it doesn‚Äôt have to execute again after replacing user data from the parameters so if there is SQL in the input it won‚Äôt be compiled. The static query from our example below would like: ‚Äú SELECT username, password from Users where username = ‚Äú?‚Äù and password = ‚Äú?‚Äù ‚Äù The question marks representing the parameters.</p><h1>ii.Broken Auth</h1><p>‚ÄúThese types of weaknesses can allow an attacker to either capture or bypass the authentication methods that are used by a web application.</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>User authentication credentials are not protected when stored.
Predictable login credentials.
Session IDs are exposed in the URL (e.g., URL rewriting).
Session IDs are vulnerable to session fixation attacks.
Session value does not timeout or does not get invalidated after logout.
Session IDs are not rotated after successful login.
Passwords, session IDs, and other credentials are sent over unencrypted connections.
</code></pre></div></div><p>The goal of an attack is to take over one or more accounts and for the attacker to get the same privileges as the attacked user.‚Äù-OWASP</p><p>To illustrate this type of attack, we‚Äôre going to abuse a compromised security question answer in the forgot password function of the application. When a attacker is targeting a site or person diligently any information on the internet can be leveraged to gain access to their accounts. In this example the creator of the application made a presentation on youtube for an conference explaining the Juice Shop application. In the video he makes his account live and writes his security question answer in plaintext. Using this security question answer we can reset his account with the forgot password function. This is the url for link to the conference talk:<a href="https://www.youtube.com/watch?v=Lu0-kDdtVf4">https://www.youtube.com/watch?v=Lu0-kDdtVf4</a></p><h3>Mitigation:</h3><p>In this case there‚Äôs two issues, a compromised security question and a weak forget password function. User lack of awareness to security can also be an vulnerability in a corporation, and employee security training is an essential step in improving that issue. The forgot password function should use a stronger form of proof of identity, possibly a email sent with reset instructions, a verification code made from a device that‚Äôs connected with the user on the application. Not just a security question that‚Äôs easily guessable with a little recon of the target. Keep in mind a lot of people‚Äôs security question answers are on their social media in plain sight.</p><h1>iii.Cross Site Scripting</h1><p>Cross-Site Scripting (XSS) attacks are a type of injection, in which malicious scripts are injected into otherwise benign and trusted websites. XSS attacks occur when an attacker uses a web application to send malicious code, generally in the form of a browser side script, to a different end user. Flaws that allow these attacks to succeed are quite widespread and occur anywhere a web application uses input from a user within the output it generates without validating or encoding it.-OWASP</p><p>For Cross Site Scripting, it‚Äôs injecting javascript into a application. You can leverage this vulnerability to steal cookies, bypass other protections to chain with other vulnerabilities and could potentially lead to a full browser compromise. For this example we‚Äôre just going to display a alert box using javascript code. A good way to identify vulnerable components is seeing if user input is reflected back to the screen somehow. There are different types of XSS but in this case we‚Äôre going to be exploiting a DOM XSS. A DOM XSS means that our input is reflected into the DOM of the webpage, through client side javascript.An DOM XSS consists of a source and a sink.A source is javascript function that takes user controllable input such as the url fragments,the referrer header, or even cookie names.A sink is a javascript function that takes user input from the source and displays it in the DOM without default sanitization. In to order to exploit this we have to login and go to track orders. We can use FireFox‚Äôs dev tools to look at what happens in the backend. After this we can run this query <code class="highlighter-rouge">&lt;img src =x onerror= alert(1)&gt;</code> instead of random letters.This syntax works for two reasons. The first reason is that script tags aren‚Äôt allowed to be executed in innerHTML, the sink in this case(unless you use srcdoc with an iframe),so a img tag will replace the usually used script tag and work just fine in this scenario.The second reason is that this tells the application to look for the img source of x, but since that doesn‚Äôt exist it runs our actual javascript on error,which pops up a alert box with a 1 in it.</p><h3>Mitigation:</h3><p>Proper validation of any user input is key in stopping cross site scripting. Encoding any special characters with htmlentities() or any other related function while encoding any type of input in a web application is a good fix.</p><h1>iv.Broken Access Control</h1><p>Access control, sometimes called authorization, is how a web application grants access to content and functions to some users and not others. These checks are performed after authentication, and govern what ‚Äòauthorized‚Äô users are allowed to do. Access control sounds like a simple problem but is insidiously difficult to implement correctly. A web application‚Äôs access control model is closely tied to the content and functions that the site provides. In addition, the users may fall into a number of groups or roles with different abilities or privileges.-OWASP</p><p>For this example, we‚Äôre going to be accessing another‚Äôs users basket. In order to do this we have to make two user accounts. For the first one we‚Äôre going to add a number of items to the basket. In the second account we‚Äôre going to use Firefox dev tools to change the BID stored in the session we‚Äôre given after logging in. After we click the Storage tab we should see a section called Session Storage. In that section there‚Äôs a value called bid. We‚Äôre going to change that bid to the other bid of the account we added items too. After this you should be able to see the other accounts basket with all the items included in the cart. Imagine the risk if this was a actual scenario and someone had their credit card tied to the account and an attacker clicked checkout and changed the delivery information to his own.</p><h3>Mitigation:</h3><p>In this scenario the proper mitigation would be not to have the bid stored locally but on the server, and to provide encryption and checks to make sure that value wasn‚Äôt tampered with during the sending of the request. The main problem is that‚Äôs their no access controls to check if the bid is used for the correct user.</p></div><ul class="post__social"><li><a href="https://www.facebook.com/sharer/sharer.php?u=jsecu.github.io" target="_blank"><i class="fa fa-facebook"></i></a></li><li><a href="https://twitter.com/intent/tweet?&text=Pentesting Workshop: Working with OWASP JuiceShop+https://jsecu.github.io" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="https://plus.google.com/share?url=https://jsecu.github.io" target="_blank"><i class="fa fa-google-plus"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?mini=true&source=Pentesting Workshop: Working with OWASP JuiceShop&summary=&url=https://jsecu.github.io" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://www.stumbleupon.com/badge/?url=https://jsecu.github.io" target="_blank"><i class="fa fa-stumbleupon"></i></a></li><li><a href="https://www.reddit.com/submit?url=https://jsecu.github.io" target="_blank"><i class="fa fa-reddit-alien"></i></a></li><li><a href="https://www.tumblr.com/share/link?url=https://jsecu.github.io" target="_blank"><i class="fa fa-tumblr"></i></a></li><li><a href="https://www.pinterest.com/pin/create/link/?description=&media=https://jsecu.github.io&url=https://jsecu.github.io" target="_blank"><i class="fa fa-pinterest"></i></a></li></ul></div></div></article></div></main><footer class="footer section-padding"><div class="grid"><div class="subscribe" id="subscribe"><div class="subscribe__container"> <span class="subscribe__title">JSECU</span><p class="subscribe__text">Enjoy your stay</p></div></div><hr class="sep--white"/><div class="footer__container"><ul class="footer__tags"></ul><ul class="footer__social"><li><a href="https://twitter.com/Pullerze" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="" target="_blank"><i class="fa fa-instagram"></i></a></li><li><a href="" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://github.com/jsecu" target="_blank"><i class="fa fa-github"></i></a></li><li><a href="" target="_blank"><i class="fa fa-codepen"></i></a></li></ul></div></div></footer><section class="contact popup"><div class="popup__close"><div class="popup__exit"></div></div><div class="contact__container popup__container"><div class="contact__img"><figure class="absolute-bg" style="background-image: url(/assets/images/placeholder-28.jpg);"></figure></div><div class="contact__content"><div class="contact__mast section-padding--half"><div class="grid"><h2>Cont</h2></div></div><div class="section-padding--none"><hr class="sep"/></div><div class="contact__form section-padding--half"><div class="grid-xlarge"> <form id="form" class="form" action="" method="POST"><div class="form__subcontainer"><div> <label for="form-first-name">First Name</label> <input type="text" name="first-name" id="form-first-name" required></div><div> <label for="form-last-name">Last Name</label> <input type="text" name="last-name" id="form-last-name" required></div></div><div> <label for="form-email">E-Mail</label> <input type="email" name="email" id="form-email" required></div><div> <label for="form-message">Message</label> <textarea name="message" id="form-message" rows="3"></textarea></div><div class="form__submit"><div class="form__btn"> <input type="submit" value="Send"></div></div><p class="form__message"></p></form></div></div></div></div></section><script src="/assets/js/app.min.js"></script></body></html>
  