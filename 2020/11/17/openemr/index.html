<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>OpenEMR 5.0.1.3 Arbitrary File Actions | JSECU</title><meta name="description" content="JSECU"><meta itemprop="name" content="JSECU"><meta itemprop="description" content="JSECU"><meta itemprop="image" content="http://localhost:4000/images/openemr.png"><meta property="og:url" content="http://localhost:4000/2020/11/17/openemr/"><meta property="og:type" content="website"><meta property="og:title" content="OpenEMR 5.0.1.3 Arbitrary File Actions | JSECU"><meta property="og:site_name" content="JSECU"><meta property="og:description" content="JSECU"><meta property="og:image" content="http://localhost:4000/images/openemr.png"><meta name="twitter:url" content="http://localhost:4000/2020/11/17/openemr/"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="OpenEMR 5.0.1.3 Arbitrary File Actions | JSECU"><meta name="twitter:site" content="JSECU"><meta name="twitter:description" content="JSECU"><meta name="twitter:creator" content="@Pullerze"><meta property="twitter:image" content="http://localhost:4000/images/openemr.png"><link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico"><link rel="stylesheet" href="/assets/css/app.min.css"><link rel="alternate" type="application/rss+xml" title="JSECU" href="/feed.xml"><link rel="canonical" href="/2020/11/17/openemr/"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'n', 'auto'); ga('send', 'pageview'); </script></head><body id="openemr-5-0-1-3-arbitrary-file-actions" class="post-layout"><header class="header"> <a class="header__title" href="http://localhost:4000/">JSECU</a><nav><ul class="header__list"><li><a href="/">Posts</a></li><li><a href="/about">About</a></li></ul></nav></header><main class="ðŸ’ˆ"><div class="post"><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><div class="post__header section-padding--double"><div class="grid-small"><h2 itemprop="name headline">OpenEMR 5.0.1.3 Arbitrary File Actions</h2><time class="post__date" datetime="2020-11-17T17:40:20-05:00" itemprop="datePublished">17 Nov 2020</time></div></div><div class="post__content section-padding"><div class="grid"><div id="markdown" itemprop="articleBody"><p><img src="../../../../images/openemr.png" /></p><p>Back in 2018, a group of security researchers and I decided to try our hands at OpenEMR and find security vulnerabilities.The full report can be found <a href="https://www.open-emr.org/wiki/images/1/11/Openemr_insecurity.pdf">here</a>.This a very good read and I recommend reading it in its entirety. However this blog post is just documenting my contribution to the project.The following are the three CVEs I received in the collaboration. These were all responsibly disclosed and patched so upgrading to the latest version would be well advised.</p><p>1.CVE-2018-15140-Authenicated Arbitrary Read</p><p>Vulnerable Code:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  if ($_POST['mode'] == 'get'){
     echo file_get_contents($_POST['docid']);
     exit;
  }
</code></pre></div></div><p>This is a vulnerability that allows an attacker to make a malicious request to /portal/import_template.php on a unpatched instance of OpenEMR.The result of this request is an arbitrary file read of a local file located on the file system.This vulnerability was possible due to the application passing user input into file_get_contents() without any sanitization if the parameter mode is set with get as its value. This result of this input,which is the local file, was then echoed back in the html response.</p><p>2.CVE-2018-15142-Authenicated Arbitrary Write</p><p>Vulnerable Code:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>} else if ($_POST['mode'] == 'save') {
    file_put_contents($_POST['docid'], $_POST['content']);
    exit(true);
}
</code></pre></div></div><p>This is an vulnerability in /portal/import_template.php which allows an attacker to write php files to a local file system.This works if the parameter mode is set to save.If that is the case the post parameters docid and content are passed to file_put_contents() without any sanitization.The docid is the file name and the content includes the malicious php code. This by itself doesnâ€™t have that much impact since you cannot execute the file, but when paired up with the previously found arbitrary file read, leads to remote code execution.</p><p>3.CVE-2018-15141- Authenticated Arbitrary File Delete</p><p>Vulnerable Code:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> } else if ($_POST['mode'] == 'delete') {
     unlink($_POST['docid']);
     exit(true);
 }
</code></pre></div></div><p>This is an vulnerability also in /portal/import_template.php which allows an attacker to delete any file in the system if the filename is known and the permissions to delete are allowed.This is possible when the post parameter mode is set to delete. The docid parameter which contains the file name specified by the attacker is then passed to unlink() without sanitization.</p><p>Thank you for reading and hope you enjoyed.You can find Pocs for any one of these on ExploitDB, <a href="https://www.exploit-db.com/exploits/45202">here</a></p></div><ul class="post__social"><li><a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2020/11/17/openemr/" target="_blank"><i class="fa fa-facebook"></i></a></li><li><a href="https://twitter.com/intent/tweet?&text=OpenEMR 5.0.1.3 Arbitrary File Actions+http://localhost:4000/2020/11/17/openemr/" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="https://plus.google.com/share?url=http://localhost:4000/2020/11/17/openemr/" target="_blank"><i class="fa fa-google-plus"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?mini=true&source=OpenEMR 5.0.1.3 Arbitrary File Actions&summary=&url=http://localhost:4000/2020/11/17/openemr/" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://www.stumbleupon.com/badge/?url=http://localhost:4000/2020/11/17/openemr/" target="_blank"><i class="fa fa-stumbleupon"></i></a></li><li><a href="https://www.reddit.com/submit?url=http://localhost:4000/2020/11/17/openemr/" target="_blank"><i class="fa fa-reddit-alien"></i></a></li><li><a href="https://www.tumblr.com/share/link?url=http://localhost:4000/2020/11/17/openemr/" target="_blank"><i class="fa fa-tumblr"></i></a></li><li><a href="https://www.pinterest.com/pin/create/link/?description=&media=http://localhost:4000/images/openemr.png&url=http://localhost:4000/2020/11/17/openemr/" target="_blank"><i class="fa fa-pinterest"></i></a></li></ul></div></div></article></div></main><footer class="footer section-padding"><div class="grid"><div class="subscribe" id="subscribe"><div class="subscribe__container"> <span class="subscribe__title">JSECU</span><p class="subscribe__text">Enjoy your stay</p></div></div><hr class="sep--white"/><div class="footer__container"><ul class="footer__tags"></ul><ul class="footer__social"><li><a href="https://twitter.com/Pullerze" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="" target="_blank"><i class="fa fa-instagram"></i></a></li><li><a href="" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://github.com/jsecu" target="_blank"><i class="fa fa-github"></i></a></li><li><a href="" target="_blank"><i class="fa fa-codepen"></i></a></li></ul></div></div></footer><section class="contact popup"><div class="popup__close"><div class="popup__exit"></div></div><div class="contact__container popup__container"><div class="contact__img"><figure class="absolute-bg" style="background-image: url(/assets/images/placeholder-28.jpg);"></figure></div><div class="contact__content"><div class="contact__mast section-padding--half"><div class="grid"><h2>Cont</h2></div></div><div class="section-padding--none"><hr class="sep"/></div><div class="contact__form section-padding--half"><div class="grid-xlarge"> <form id="form" class="form" action="" method="POST"><div class="form__subcontainer"><div> <label for="form-first-name">First Name</label> <input type="text" name="first-name" id="form-first-name" required></div><div> <label for="form-last-name">Last Name</label> <input type="text" name="last-name" id="form-last-name" required></div></div><div> <label for="form-email">E-Mail</label> <input type="email" name="email" id="form-email" required></div><div> <label for="form-message">Message</label> <textarea name="message" id="form-message" rows="3"></textarea></div><div class="form__submit"><div class="form__btn"> <input type="submit" value="Send"></div></div><p class="form__message"></p></form></div></div></div></div></section><script src="/assets/js/app.min.js"></script></body></html>
  